<script>
  let rooms = [];
  let walls = [];
  let doors = [];
  let windowsArr = [];

  // ===== STEP 1: ROOMS =====
  function addRoom() {
    const name = document.getElementById('roomName').value.trim();
    if (!name) return;
    if (rooms.includes(name)) { alert("Room already exists!"); return; }
    rooms.push(name);
    updateRoomList();
    document.getElementById('roomName').value = '';
    updateWallRoomOptions();
    saveData();
  }
  function updateRoomList() {
    const list = document.getElementById('roomList');
    list.innerHTML = rooms.map(r => `<div class="list-item">${r}</div>`).join('');
    updateWallRoomOptions();
  }
  function updateWallRoomOptions() {
    document.getElementById('wallRoom').innerHTML =
      rooms.map(r => `<option value="${r}">${r}</option>`).join('');
  }

  // ===== STEP 2: WALLS =====
  function addWall() {
    const name = wallName.value.trim();
    const length = wallLength.value;
    const height = wallHeight.value;
    const room = wallRoom.value;
    if (!name || !length || !height || !room) return;
    walls.push({name,length,height,room});
    updateWallList();
    wallName.value = wallLength.value = wallHeight.value = '';
    updateWallOptions();
    saveData();
  }
  function updateWallList() {
    wallList.innerHTML = walls.map(
      w => `<div class="list-item">${w.name} - ${w.length}x${w.height} (Room: ${w.room})</div>`
    ).join('');
    updateWallOptions();
  }
  function updateWallOptions() {
    const wallOpts = walls.map(w => `<option value="${w.name}">${w.name} (${w.room})</option>`).join('');
    doorWall.innerHTML = wallOpts;
    windowWall.innerHTML = wallOpts;
  }

  // ===== STEP 3: DOORS =====
  function addDoor() {
    const name = doorName.value.trim();
    const width = doorWidth.value;
    const height = doorHeight.value;
    const wall = doorWall.value;
    if (!name || !width || !height || !wall) return;
    doors.push({name,width,height,wall});
    updateDoorList();
    doorName.value = '';
    saveData();
  }
  function updateDoorList() {
    doorList.innerHTML = doors.map(
      d => `<div class="list-item">${d.name} - ${d.width}x${d.height} (Wall: ${d.wall})</div>`
    ).join('');
  }

  // ===== STEP 4: WINDOWS =====
  function addWindow() {
    const name = windowName.value.trim();
    const width = windowWidth.value;
    const height = windowHeight.value;
    const wall = windowWall.value;
    if (!name || !width || !height || !wall) return;
    windowsArr.push({name,width,height,wall});
    updateWindowList();
    windowName.value = '';
    saveData();
  }
  function updateWindowList() {
    windowList.innerHTML = windowsArr.map(
      w => `<div class="list-item">${w.name} - ${w.width}x${w.height} (Wall: ${w.wall})</div>`
    ).join('');
  }

  // ===== NAVIGATION =====
  function nextStep(n) {
    document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden'));
    document.getElementById('step'+n).classList.remove('hidden');
    if (n === 5) { generatePreview(); saveData(); }
  }
  function prevStep(n) { nextStep(n); }

  // ===== PREVIEW =====
  function generatePreview() {
    const preview = document.getElementById('preview');
    preview.innerHTML = '';

    rooms.forEach(r => {
      preview.innerHTML += `<div class="list-item"><strong>Room:</strong> ${r}</div>`;
    });
    walls.forEach(w => {
      preview.innerHTML += `<div class="list-item"><strong>Wall:</strong> ${w.name} - ${w.length}x${w.height} (Room: ${w.room})</div>`;
    });
    doors.forEach(d => {
      preview.innerHTML += `<div class="list-item"><strong>Door:</strong> ${d.name} - ${d.width}x${d.height} (Wall: ${d.wall})</div>`;
    });
    windowsArr.forEach(w => {
      preview.innerHTML += `<div class="list-item"><strong>Window:</strong> ${w.name} - ${w.width}x${w.height} (Wall: ${w.wall})</div>`;
    });
  }

  // ===== SAVE TO LOCAL STORAGE =====
  function saveData() {
    const data = {
      rooms,
      walls,
      doors,
      windows: windowsArr
    };
    localStorage.setItem('boq_project_step2', JSON.stringify(data));
  }
</script>
